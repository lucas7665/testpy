<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëû∫Á∫πÈí¢RSIÂÆûÊó∂ÁõëÊéß</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .timestamp {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .card-change {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }

        .positive {
            color: #10b981;
            background: #d1fae5;
        }

        .negative {
            color: #ef4444;
            background: #fee2e2;
        }

        .rsi-card {
            position: relative;
        }

        .rsi-value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .rsi-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .rsi-fill {
            height: 100%;
            transition: width 0.5s ease, background 0.5s ease;
            border-radius: 5px;
        }

        .rsi-oversold {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .rsi-overbought {
            background: linear-gradient(90deg, #f59e0b, #ef4444);
        }

        .rsi-normal {
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
        }

        .rsi-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            height: 400px; /* Âõ∫ÂÆöÈ´òÂ∫¶ */
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart-wrapper {
            height: calc(100% - 50px); /* ÂáèÂéªÊ†áÈ¢òÈ´òÂ∫¶ */
            position: relative;
        }
        
        .chart-wrapper canvas {
            max-height: 100%;
        }

        .signal-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .signal-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .signal-text {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .signal-description {
            color: #666;
            line-height: 1.6;
        }

        .signal-buy {
            border-left: 5px solid #10b981;
        }

        .signal-sell {
            border-left: 5px solid #ef4444;
        }

        .signal-hold {
            border-left: 5px solid #6366f1;
        }

        .signal-history {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .signal-history-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .signal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .signal-table thead {
            background: #f3f4f6;
        }

        .signal-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .signal-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .signal-table tr:hover {
            background: #f9fafb;
        }

        .signal-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        .signal-badge-buy {
            background: #d1fae5;
            color: #065f46;
        }

        .signal-badge-strong-buy {
            background: #10b981;
            color: white;
        }

        .signal-badge-sell {
            background: #fee2e2;
            color: #991b1b;
        }

        .signal-badge-strong-sell {
            background: #ef4444;
            color: white;
        }

        .signal-badge-hold {
            background: #e0e7ff;
            color: #3730a3;
        }

        .price-up {
            color: #10b981;
        }

        .price-down {
            color: #ef4444;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .updating {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Ëû∫Á∫πÈí¢RSIÂÆûÊó∂ÁõëÊéß</h1>
            <div class="timestamp" id="timestamp">Ê≠£Âú®Âä†ËΩΩ...</div>
        </div>

        <div id="loading" class="loading">
            ‚è≥ Ê≠£Âú®Ëé∑ÂèñÊï∞ÊçÆ...
        </div>

        <div id="content" style="display: none;">
            <!-- ‰ª™Ë°®Áõò -->
            <div class="dashboard">
                <!-- ‰ª∑Ê†ºÂç°Áâá -->
                <div class="card">
                    <div class="card-title">ÂΩìÂâç‰ª∑Ê†º</div>
                    <div class="card-value" id="current-price">-</div>
                    <div class="card-change" id="price-change">-</div>
                </div>

                <!-- RSI6Âç°Áâá -->
                <div class="card rsi-card">
                    <div class="card-title">RSI(6) - Áü≠Á∫øÊåáÊ†á</div>
                    <div class="rsi-value" id="rsi6-value">-</div>
                    <div class="rsi-bar">
                        <div class="rsi-fill" id="rsi6-fill"></div>
                    </div>
                    <div class="rsi-label">
                        <span>Ë∂ÖÂçñ(30)</span>
                        <span>Ë∂Ö‰π∞(70)</span>
                    </div>
                </div>

                <!-- RSI12Âç°Áâá -->
                <div class="card rsi-card">
                    <div class="card-title">RSI(12) - ‰∏≠Á∫øÊåáÊ†á</div>
                    <div class="rsi-value" id="rsi12-value">-</div>
                    <div class="rsi-bar">
                        <div class="rsi-fill" id="rsi12-fill"></div>
                    </div>
                    <div class="rsi-label">
                        <span>Ë∂ÖÂçñ(30)</span>
                        <span>Ë∂Ö‰π∞(70)</span>
                    </div>
                </div>

                <!-- RSI24Âç°Áâá -->
                <div class="card rsi-card">
                    <div class="card-title">RSI(24) - ÈïøÁ∫øÊåáÊ†á</div>
                    <div class="rsi-value" id="rsi24-value">-</div>
                    <div class="rsi-bar">
                        <div class="rsi-fill" id="rsi24-fill"></div>
                    </div>
                    <div class="rsi-label">
                        <span>Ë∂ÖÂçñ(30)</span>
                        <span>Ë∂Ö‰π∞(70)</span>
                    </div>
                </div>
            </div>

            <!-- ‰∫§Êòì‰ø°Âè∑ -->
            <div class="signal-box" id="signal-box">
                <div class="signal-icon" id="signal-icon">‚è≥</div>
                <div class="signal-text" id="signal-text">Á≠âÂæÖ‰ø°Âè∑...</div>
                <div class="signal-description" id="signal-description">Ê≠£Âú®ÂàÜÊûêÂ∏ÇÂú∫Êï∞ÊçÆ...</div>
            </div>

            <!-- ‰ø°Âè∑ËÆ∞ÂΩïÂéÜÂè≤ -->
            <div class="signal-history">
                <div class="signal-history-title">üìã ‰ø°Âè∑ËÆ∞ÂΩïÔºàÊúÄËøë20Êù°Ôºâ</div>
                <table class="signal-table">
                    <thead>
                        <tr>
                            <th>Êó∂Èó¥</th>
                            <th>‰ª∑Ê†º</th>
                            <th>RSI6</th>
                            <th>RSI12</th>
                            <th>RSI24</th>
                            <th>‰ø°Âè∑</th>
                        </tr>
                    </thead>
                    <tbody id="signal-history-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: #9ca3af;">
                                Ê≠£Âú®Âä†ËΩΩ‰ø°Âè∑ËÆ∞ÂΩï...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ‰ª∑Ê†ºÂõæË°® -->
            <div class="chart-container">
                <div class="chart-title">üìà ÂÆûÊó∂‰ª∑Ê†ºËµ∞Âäø</div>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- RSIÂõæË°® -->
            <div class="chart-container">
                <div class="chart-title">üìä RSIÊåáÊ†áËµ∞Âäø</div>
                <div class="chart-wrapper">
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let priceChart, rsiChart;

        // ÂàùÂßãÂåñÂõæË°®
        function initCharts() {
            // ‰ª∑Ê†ºÂõæË°®
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Êî∂Áõò‰ª∑',
                        data: [],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxTicksLimit: 10  // ÊúÄÂ§öÊòæÁ§∫10‰∏™ÂàªÂ∫¶
                            }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // RSIÂõæË°®
            const rsiCtx = document.getElementById('rsiChart').getContext('2d');
            rsiChart = new Chart(rsiCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'RSI(6)',
                            data: [],
                            borderColor: '#10b981',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            tension: 0.4
                        },
                        {
                            label: 'RSI(12)',
                            data: [],
                            borderColor: '#f59e0b',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            tension: 0.4
                        },
                        {
                            label: 'RSI(24)',
                            data: [],
                            borderColor: '#8b5cf6',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxTicksLimit: 10  // ÊúÄÂ§öÊòæÁ§∫10‰∏™ÂàªÂ∫¶
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
        }

        // Êõ¥Êñ∞RSIÊòæÁ§∫
        function updateRSI(elementPrefix, value) {
            if (value === null || value === undefined) {
                document.getElementById(`${elementPrefix}-value`).textContent = '-';
                return;
            }

            document.getElementById(`${elementPrefix}-value`).textContent = value.toFixed(2);
            
            const fill = document.getElementById(`${elementPrefix}-fill`);
            fill.style.width = value + '%';

            if (value < 30) {
                fill.className = 'rsi-fill rsi-oversold';
            } else if (value > 70) {
                fill.className = 'rsi-fill rsi-overbought';
            } else {
                fill.className = 'rsi-fill rsi-normal';
            }
        }

        // Âà§Êñ≠‰ø°Âè∑Á±ªÂûã
        function getSignalType(rsi6, rsi12) {
            if (rsi6 < 30) {
                if (rsi12 < 40) {
                    return { type: 'strong-buy', text: 'Âº∫ÁÉà‰π∞ÂÖ•', icon: 'üîîüîî' };
                } else {
                    return { type: 'buy', text: '‰π∞ÂÖ•‰ø°Âè∑', icon: 'üîî' };
                }
            } else if (rsi6 > 70) {
                if (rsi12 > 60) {
                    return { type: 'strong-sell', text: 'Âº∫ÁÉàÂçñÂá∫', icon: '‚ö†Ô∏è‚ö†Ô∏è' };
                } else {
                    return { type: 'sell', text: 'ÂçñÂá∫‰ø°Âè∑', icon: '‚ö†Ô∏è' };
                }
            } else {
                return { type: 'hold', text: 'ËßÇÊúõ', icon: '‚è≥' };
            }
        }

        // Êõ¥Êñ∞‰ø°Âè∑ÂéÜÂè≤Ë°®Ê†º
        function updateSignalHistory(chartData) {
            const tbody = document.getElementById('signal-history-body');
            tbody.innerHTML = '';

            // Ëé∑ÂèñÊúÄËøë20Êù°Êï∞ÊçÆ
            const dataLength = chartData.close.length;
            const startIdx = Math.max(0, dataLength - 20);
            
            let hasSignals = false;

            for (let i = dataLength - 1; i >= startIdx; i--) {
                const time = chartData.time[i];
                const price = chartData.close[i];
                const rsi6 = chartData.rsi6[i];
                const rsi12 = chartData.rsi12[i];
                const rsi24 = chartData.rsi24[i];

                if (rsi6 === null || rsi6 === undefined) continue;

                const signal = getSignalType(rsi6, rsi12);
                
                // Âè™ÊòæÁ§∫‰π∞ÂÖ•ÂíåÂçñÂá∫‰ø°Âè∑Ôºå‰∏çÊòæÁ§∫ËßÇÊúõ
                if (signal.type === 'hold') continue;

                hasSignals = true;

                const row = document.createElement('tr');
                
                // ‰ª∑Ê†ºÈ¢úËâ≤
                let priceClass = '';
                if (i > 0 && chartData.close[i-1]) {
                    priceClass = price > chartData.close[i-1] ? 'price-up' : 'price-down';
                }

                row.innerHTML = `
                    <td>${time}</td>
                    <td class="${priceClass}">${price ? price.toFixed(2) : '-'}</td>
                    <td>${rsi6 ? rsi6.toFixed(2) : '-'}</td>
                    <td>${rsi12 ? rsi12.toFixed(2) : '-'}</td>
                    <td>${rsi24 ? rsi24.toFixed(2) : '-'}</td>
                    <td>
                        <span class="signal-badge signal-badge-${signal.type}">
                            ${signal.icon} ${signal.text}
                        </span>
                    </td>
                `;

                tbody.appendChild(row);
            }

            if (!hasSignals) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: #9ca3af;">
                            ÊöÇÊó†‰∫§Êòì‰ø°Âè∑
                        </td>
                    </tr>
                `;
            }
        }

        // Êõ¥Êñ∞‰∫§Êòì‰ø°Âè∑
        function updateSignal(rsi6, rsi12) {
            const signalBox = document.getElementById('signal-box');
            const signalIcon = document.getElementById('signal-icon');
            const signalText = document.getElementById('signal-text');
            const signalDesc = document.getElementById('signal-description');

            signalBox.className = 'signal-box';

            if (rsi6 < 30) {
                signalBox.classList.add('signal-buy');
                signalIcon.textContent = 'üîî';
                signalText.textContent = '‰π∞ÂÖ•‰ø°Âè∑';
                
                if (rsi12 < 40) {
                    signalDesc.textContent = 'üîîüîî Â§öÂë®ÊúüÂÖ±ÊåØÔºÅRSI6ÂíåRSI12ÈÉΩËøõÂÖ•Ë∂ÖÂçñÂå∫ÂüüÔºåÂº∫ÁÉà‰π∞ÂÖ•‰ø°Âè∑ÔºÅ';
                } else {
                    signalDesc.textContent = 'RSI6ËøõÂÖ•Ë∂ÖÂçñÂå∫ÂüüÔºåÂèØËÉΩÂá∫Áé∞ÂèçÂºπÔºåÂª∫ËÆÆËÄÉËôë‰π∞ÂÖ•„ÄÇ';
                }
            } else if (rsi6 > 70) {
                signalBox.classList.add('signal-sell');
                signalIcon.textContent = '‚ö†Ô∏è';
                signalText.textContent = 'ÂçñÂá∫‰ø°Âè∑';
                
                if (rsi12 > 60) {
                    signalDesc.textContent = '‚ö†Ô∏è‚ö†Ô∏è Â§öÂë®ÊúüÂÖ±ÊåØÔºÅRSI6ÂíåRSI12ÈÉΩËøõÂÖ•Ë∂Ö‰π∞Âå∫ÂüüÔºåÂº∫ÁÉàÂçñÂá∫‰ø°Âè∑ÔºÅ';
                } else {
                    signalDesc.textContent = 'RSI6ËøõÂÖ•Ë∂Ö‰π∞Âå∫ÂüüÔºåÂèØËÉΩÂá∫Áé∞ÂõûË∞ÉÔºåÂª∫ËÆÆËÄÉËôëÂçñÂá∫ÊàñÊ≠¢Áõà„ÄÇ';
                }
            } else {
                signalBox.classList.add('signal-hold');
                signalIcon.textContent = '‚è≥';
                signalText.textContent = 'ËßÇÊúõ';
                signalDesc.textContent = 'RSIÂú®Ê≠£Â∏∏Âå∫Èó¥ÂÜÖÔºåÊöÇÊó†ÊòéÁ°Æ‰∫§Êòì‰ø°Âè∑ÔºåÂª∫ËÆÆÁªßÁª≠ËßÇÊúõ„ÄÇ';
            }
        }

        // Ëé∑ÂèñÊï∞ÊçÆÂπ∂Êõ¥Êñ∞ÁïåÈù¢
        async function fetchData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•');
                }

                // ÈöêËóèÂä†ËΩΩÔºåÊòæÁ§∫ÂÜÖÂÆπ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

                // Êõ¥Êñ∞Êó∂Èó¥Êà≥
                document.getElementById('timestamp').textContent = 'Êõ¥Êñ∞Êó∂Èó¥: ' + data.timestamp;

                // Êõ¥Êñ∞‰ª∑Ê†º
                const current = data.current;
                document.getElementById('current-price').textContent = current.price.toFixed(2);
                
                const changeEl = document.getElementById('price-change');
                const changeText = `${current.change >= 0 ? '+' : ''}${current.change.toFixed(2)} (${current.change_pct >= 0 ? '+' : ''}${current.change_pct.toFixed(2)}%)`;
                changeEl.textContent = changeText;
                changeEl.className = 'card-change ' + (current.change >= 0 ? 'positive' : 'negative');

                // Êõ¥Êñ∞RSI
                updateRSI('rsi6', current.rsi6);
                updateRSI('rsi12', current.rsi12);
                updateRSI('rsi24', current.rsi24);

                // Êõ¥Êñ∞‰∫§Êòì‰ø°Âè∑
                updateSignal(current.rsi6, current.rsi12);

                // Êõ¥Êñ∞‰ø°Âè∑ÂéÜÂè≤
                const chart = data.chart;
                updateSignalHistory(chart);

                // Êõ¥Êñ∞ÂõæË°®
                
                // ‰ª∑Ê†ºÂõæË°®
                priceChart.data.labels = chart.time;
                priceChart.data.datasets[0].data = chart.close;
                priceChart.update('none');

                // RSIÂõæË°®
                rsiChart.data.labels = chart.time;
                rsiChart.data.datasets[0].data = chart.rsi6;
                rsiChart.data.datasets[1].data = chart.rsi12;
                rsiChart.data.datasets[2].data = chart.rsi24;
                rsiChart.update('none');

            } catch (error) {
                console.error('Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:', error);
                document.getElementById('timestamp').textContent = 'Êõ¥Êñ∞Â§±Ë¥•: ' + error.message;
            }
        }

        // ÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            initCharts();
            fetchData();
            
            // ÊØè10ÁßíËá™Âä®Âà∑Êñ∞
            setInterval(fetchData, 10000);
        });
    </script>
</body>
</html>

